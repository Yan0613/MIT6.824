# MIT6.824

MIT6.824(现6.5840)分布式系统lab1-lab4,渐进式实现一个KV分布式系统。
课程主页: <https://pdos.csail.mit.edu/6.824/labs/lab-mr.html>
前置要求：Go语言基础，重点掌握管道相关知识；MapReduce论文

## Lab1 MapReduce

Map是接收一组键值对，并且通过特定方式对其排序（在Lab1提到的word count例子中，键是词，值是词出现的次数，排序之后同一个词会集中出现）。
Reduce则合并相同键的值，以word count为例，Reduce是将相同单词的值（即出现的次数）相加。
![Alt text](image.png)

工作流程图里说得很清楚：

- 系统会启动一个或多个Master，需要执行任务的机器启动Worker来处理任务。Master主要职责是分配任务给Worker，Master可以随机选择空闲的Worker来分配任务，或者Worker主动向Master请求任务；
- 获得map任务的Worker，读取数据分片，生成一组key/value键值对的中间值集合，并将数据写到本地文件，这里每个map任务数据分为R份(Master创建reduce任务的数量)，通过用户定义的分区函数(如hash(key) mod R)决定将key存在哪个文件；
- 获得reduce任务的Worker，通过远程调用请求数据，数据加载完毕后，对数据进行排序，之后遍历数据，将相同key的数据进行合并，最终输出结果；
- 当所有的map和reduce任务完成了，整个MapReduce程序就处理完毕了，Worker得到处理后的数据，通常会保存在不同的小文件中，合并这些文件之后就是最重要的结果。——转自知乎划拳小匠，网站：<https://zhuanlan.zhihu.com/p/187507617>

Tips: Go语言的通道
Go 语言中的通道（channel）是一种用于在不同的 Goroutines 之间进行通信和同步的机制。通道可以让不同的 Goroutines 安全地传递数据，以避免竞态条件和共享内存问题。以下是关于 Go 语言通道的基本概念和使用方法：

1. **通道的创建：**
   你可以使用内置的 `make` 函数来创建一个通道。通道有两种类型：带缓冲和不带缓冲。带缓冲的通道可以容纳一定数量的数据项，而不带缓冲的通道在发送和接收数据时需要 Goroutines 同时准备好。

   ```go
   // 创建一个不带缓冲的通道
   ch := make(chan int)
   
   // 创建一个带缓冲的通道，容量为 10
   ch := make(chan int, 10)
   ```

2. **通道的发送和接收：**
   使用通道的 `<-` 操作符进行数据的发送和接收。发送操作将数据发送到通道，接收操作从通道中接收数据。

   ```go
   // 发送数据到通道
   ch <- 42
   
   // 从通道中接收数据
   data := <-ch
   ```

3. **通道的关闭：**
   通道可以被关闭，以表示没有更多的数据将被发送到通道。通常在发送者知道不再需要发送数据时关闭通道，接收者可以通过检查通道是否关闭来判断是否还有数据。

   ```go
   close(ch)
   ```

4. **通道的选择语句：**
   通道经常与 `select` 语句一起使用，允许在多个通道之间进行非阻塞的选择。这对于处理多路数据流很有用。

   ```go
   select {
   case msg1 := <-ch1:
       // 处理从 ch1 接收到的数据
   case msg2 := <-ch2:
       // 处理从 ch2 接收到的数据
   case ch3 <- data:
       // 发送数据到 ch3
   default:
       // 如果没有通道准备好，执行默认操作
   }
   ```

5. **通道的阻塞：**
   通道的发送和接收操作是阻塞的，这意味着如果没有 Goroutines 准备好发送或接收数据，它们将会等待。这种机制可以用于同步不同 Goroutines 的执行。

6. **通道的方向：**
   在函数参数中，可以指定通道的发送或接收方向，以增强代码的类型安全性。例如，`func foo(ch <-chan int)` 表示 `ch` 是一个只接收数据的通道，而 `func bar(ch chan<- int)` 表示 `ch` 是一个只发送数据的通道。

Go 语言的通道是一种非常强大的并发工具，它们使得在多个 Goroutines 之间进行安全的数据传输和同步变得相对容易。通道的使用可以有效地避免竞态条件和减少并发编程中的错误。————Gnerate by ChatGPT
